@using System.Globalization
@using System.Linq
@using System.Web
@using Microsoft.AspNetCore.Mvc
@using starsky.Helpers
@using starsky.Services
@using starsky.ViewModels
@model DetailView

@{
    ViewData["Title"] = @Model.FileIndexItem.FileName;
}


<div class="sidebar">
    <div class="close" onclick="toggleSideMenu()"></div>
    <div class="content">

        <h4 class="nextprev">
            &nbsp;
            @if (@Model.RelativeObjects.PrevFilePath != null)
            {
                var urlPath = @Url.Action("Index", "Home", new {f = @Model.RelativeObjects.PrevFilePath});
                urlPath = urlPath.Replace("%2F", "/");
                <a class="prev" href="@urlPath">Vorige</a>
            }
            @if (@Model.RelativeObjects.NextFilePath != null ) 
            {
                var urlPath = @Url.Action("Index", "Home", new {f = @Model.RelativeObjects.NextFilePath});
                urlPath = urlPath.Replace("%2F", "/");
                <a class="next" href="@urlPath">Volgende</a>
            }
        </h4>

        <div class="thumbnail">
            <img src="@Url.Action("Thumbnail", "Api", new {f = @Model.FileIndexItem.FileHash, issingleitem = true})"/>
        </div>
        
        <div class="form-inline form-wrapper" id="js-keywords-update">
            <p>Tags: <em>(komma gescheiden)</em></p>
            <div class="form-control js-keywords contenteditable disabled" contenteditable="false" 
                 name="keywords" onfocusout="updateKeywords()" data-previouscontent="@Model.FileIndexItem.Tags">@Model.FileIndexItem.Tags</div>
            <a class="btn btn-default" type="submit" onClick="updateKeywords()">Update</a>
        </div>

        <div class="form-inline form-wrapper" id="js-captionabstract-update">
            <p>Info:</p>
            <div class="form-control js-captionabstract contenteditable disabled" contenteditable="false" 
                 name="keywords" onfocusout="updateCaptionAbstract()" data-previouscontent="@Model.FileIndexItem.Description">@Model.FileIndexItem.Description</div>
            <a class="btn btn-default disabled" type="submit" onClick="updateCaptionAbstract()">Update</a>
        </div>
        
        <div>
            @{
                if (Model.FileIndexItem.DateTime.Year >= 2)
                {
                    var cultureInfo = new CultureInfo("nl-NL");
                    <p>Datum: <em>@Model.FileIndexItem.DateTime.ToString(cultureInfo)</em></p>
                }
            }
        </div>
        <div class="add-colorclass">
            @{
                foreach (var item in @FileIndexItem.GetAllColorUserInterface())
                {
                    var enumValue = (int) item;
                    if ((int) @Model.FileIndexItem.ColorClass == enumValue)
                    {
                        <a class="colorclass-@enumValue on" data-colorclass="@enumValue" 
                           onclick="updateColorClass(this)"><span class='checkbox'></span>@item.ToString()</a>
                    }
                    else
                    {
                        <a class="colorclass-@enumValue" data-colorclass="@enumValue" onclick="updateColorClass(this)">
                            <span class='checkbox'></span>@item.ToString()
                        </a>
                    }
                }
            }
        </div>
        <div class="form-inline form-wrapper" id="js-objectname-update">
            <p>Titel:</p>
            <div class="form-control js-objectname contenteditable disabled" contenteditable="false" 
                 name="keywords" onfocusout="updateObjectName()" data-previouscontent="@Model.FileIndexItem.Title">@Model.FileIndexItem.Title</div>
            <a class="btn btn-default disabled" type="submit" onClick="updateObjectName()">Update</a>
        </div>
        
        <div class="addDeleteTag disabled">
            <h4>Danger zone:</h4>
            <a onClick="addDeleteTag()" class="btn-sm btn btn-danger delete">Verwijderen niet beschikbaar</a>
            <a asp-controller="Search" asp-action="Trash" asp-fragment="sidebar=" class="btn-sm btn btn-info">Bekijk prullenmand</a>
            <a class="btn-sm btn btn-danger status204button hide" onclick="retry204()">Reset Thumbnail</a>
        </div>
        
        <div class="download-sidebar">
            <h4>Downloads:</h4>

            @if (@Files.IsExtensionThumbnailSupported(@Model.FileIndexItem.FileName))
            {
                <a class="btn-sm btn btn-secondary" 
                   href="@Url.Action("DownloadPhoto", "Api", new {f = @Model.FileIndexItem.FilePath, isThumbnail = true})" 
                   download="@Model.FileIndexItem.FileName.Replace(".jpg", "")-th.jpg">
                    Klein
                </a>   
            }

            <a class="btn-sm btn btn-secondary" 
               href="@Url.Action("DownloadPhoto", "Api", new {f = @Model.FileIndexItem.FilePath, isThumbnail = false})" 
               download="@Model.FileIndexItem.FileName">
                Orgineel
            </a>
           
            <div class="js-collectionsswitch">
                <h4>Collecties:</h4>
                <div><a class="btn btn-default small" href="#">@Model.FileIndexItem.ImageFormat</a></div>
            </div>

        </div>
        <div class="rotation-sidebar">
            <h4>Rotatie:</h4>
            <a class="btn-sm btn btn-secondary" onClick="queryRotate(-1)">
                [
            </a>
            <a class="btn-sm btn btn-secondary" onClick="queryRotate(1)">
                ]
            </a>
        </div>



    </div>
</div>

<div class="detailview">
    <h4 class="nextprev">
        &nbsp;
        @if (@Model.RelativeObjects.PrevFilePath != null)
        {
            var urlPath = @Url.Action("Index", "Home", new {f = @Model.RelativeObjects.PrevFilePath});
            urlPath = urlPath.Replace("%2F", "/");
            <a class="prev" href="@urlPath">Vorige</a>
        }

        <span class="js-filterinfo">
            @if (@Model.ColorClassFilterList.Any())
            {
                <text>Filters:</text>
                foreach(var item in Model.ColorClassFilterList)
                {
                    var enumValue = (int) item;
                    <span class="sqbox on colorclass-@enumValue"></span>
                }
                
            }
        </span>
        
        @if (@Model.ColorClassFilterList.Any() && !Model.ColorClassFilterList.Contains(
            @Model.FileIndexItem.ColorClass))
        {
            <span>&nbsp;&nbsp;Deze file is buiten de ColorClass selectie</span>
        }
        
        @if (@Model.FileIndexItem.Tags.Contains("!delete!"))
        {
            <span>Verwijderd bestand!</span>
        }
        @if (@Model.RelativeObjects.NextFilePath != null)
        {
            var urlPath = @Url.Action("Index", "Home", new {f = @Model.RelativeObjects.NextFilePath});
            urlPath = urlPath.Replace("%2F", "/");
            <a class="next" href="@urlPath">Volgende (@Model.RelativeObjects.NextFilePath.Split("/").LastOrDefault())</a>

        }
    </h4>

    <h1 class="breadcrumb">
        @foreach (var item in Model.Breadcrumb)
        {
            var name = @item.Split("/")[item.Split("/").Length - 1];
            if (name == "")
            {
                name = "Home";
            }
            
            var urlPath = @Url.Action("Index", "Home", new {f = @item});
            urlPath = urlPath.Replace("%2F", "/");
            <a href="@urlPath">@name</a>

            <span> &raquo;</span>
        }
        <span>
            @Model.FileIndexItem.FileName
        </span>
    </h1>

    <div class="main-image">
        <img class="disabled-@Model.FileIndexItem.Orientation" src="@Url.Action("Thumbnail", "Api", new { f = @Model.FileIndexItem.FileHash, issingleitem = true })" />
    </div>
</div>


<div class="preloader">
    <img src="images/preloader.svg" alt="preloader">
</div>

<script type="text/javascript">
    @{
        // Javascript don't accept decoded slashes
        var thumbnailApiBase = Url.Action("Thumbnail", "Api", new {f = @Model.FileIndexItem.FileHash, json = true});
        thumbnailApiBase = HttpUtility.UrlDecode(thumbnailApiBase);
        var updateApiBase = Url.Action("Update", "Api", new { f = @Model.FileIndexItem.FilePath});
        updateApiBase = HttpUtility.UrlDecode(updateApiBase);
        var infoApiBase = @Url.Action("Info", "Api", new {f = @Model.FileIndexItem.FilePath});
        infoApiBase = HttpUtility.UrlDecode(infoApiBase);
    }
    var thumbnailApiBase = "@thumbnailApiBase";
    var updateApiBase = "@updateApiBase";
    var infoApiBase = "@infoApiBase";
</script>

<script type="text/javascript" src="js/loadjson.js"></script>
<script src="js/sidebar-stringhelper.js" type="text/javascript"></script>
<script src="js/sidebar.js" type="text/javascript"></script>
<script src="js/detailview.js" type="text/javascript"></script>

@*For IE/IE-Edge "object-fit: cover" *@
<script type="text/javascript" src="~/js/vendor/ofi.min.js" defer></script>