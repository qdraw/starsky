<!DOCTYPE html>
<html>
    <head>
 <!-- 

Do NOT edit this file -  
This Generated by Starsky Docs 

-->
        <meta charset="utf-8" />
        <link rel="stylesheet" href="assets/style/style.css" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>General Starsky (sln) docs</title><link rel="stylesheet" href="../assets/style/style.css"><meta name="viewport" content="width=device-width,initial-scale=1"/></head>
<body>

	<header class="docs-header">
		<div class="wrapper">
			<div class="detective"></div> <a href="../index.html" class="name">Starsky Docs</a>
		</div>
	</header>
<div id="app"><div class="container"><div class="entry-content"><div class="breadcrumb"><a href="../index.html">home</a> » <a href="readme.html">starsky</a> » readme</div>
<!-- end breadcrumb -->
        <h1 id="general-starsky-sln-docs">General Starsky (sln) docs</h1>
<h2 id="list-of-starsky-projects">List of <a href="../readme.html">Starsky</a> Projects</h2><ul id='list-of-starsky-projects-element'>
<li><strong><a href="../starsky/readme.html">starsky (sln)</a> database photo index &amp; import index project</strong><ul>
<li><a href="../starsky/starsky/readme.html">starsky</a> <em>web api application / interface</em><ul>
<li><a href="../starsky/starsky/clientapp/readme.html">clientapp</a> <em>react front-end application</em></li>
</ul>
</li>
<li><a href="../starsky/starskyimportercli/readme.html">starskyImporterCli</a> <em>import command line interface</em></li>
<li><a href="../starsky/starskygeocli/readme.html">starskyGeoCli</a> <em>gpx sync and reverse &#39;geo tagging&#39;</em></li>
<li><a href="../starsky/starskywebhtmlcli/readme.html">starskyWebHtmlCli</a> <em>publish web images to a content package</em></li>
<li><a href="../starsky/starskywebftpcli/readme.html">starskyWebFtpCli</a> <em>copy a content package to a ftp service</em></li>
<li><a href="../starsky/starskyadmincli/readme.html">starskyAdminCli</a> <em>manage user accounts</em></li>
<li><a href="../starsky/starskysynchronizecli/readme.html">starskySynchronizeCli</a> <em>check if disk changes are updated in the database</em></li>
<li><a href="../starsky/starskythumbnailcli/readme.html">starskyThumbnailCli</a> <em>speed web performance by generating smaller images</em></li>
<li><a href="../starsky/starskybusinesslogic/readme.html">Starsky Business Logic</a> <em>business logic libraries (netstandard 2.0)</em></li>
<li><a href="../starsky/starskytest/readme.html">starskyTest</a> <em>mstest unit tests</em></li>
</ul>
</li>
<li><a href="../starsky-tools/readme.html">starsky-tools</a> <em>nodejs tools to add-on tasks</em></li>
<li><a href="../starskyapp/readme.html">starskyapp</a> <em>Desktop Application (Pre-alpha code)</em><ul>
<li><a href="https://qdraw.github.io/starsky/assets/download/download.html">Download Desktop App</a> <em>Windows and Mac OS version</em></li>
</ul>
</li>
<li><a href="../history.html">Changelog</a> <em>Release notes and history</em></li>
</ul>
<h2 id="run-pre-build-binaries-fastest">Run pre-build binaries (fastest)</h2>
<p>See the <a href="readme-docker-hub.html">How use prebuild images</a> for more details about how to run docker</p>
<h2 id="build-instructions-for-docker">Build instructions for docker</h2>
<p>See the <a href="readme-docker-development.html">Docker instructions</a> for more details about how 
to compile the application for development</p>
<h2 id="build-instructions-without-docker">Build instructions (without docker)</h2>
<ol>
<li>To get started clone the repository</li>
</ol>
<pre><code class="language-sh">git clone &quot;https://github.com/qdraw/starsky.git&quot;
</code></pre>
<ol start="2">
<li><p>Get the <code>dotnet</code> 3.1.416 SDK. To get the &#39;Build apps - SDK&#39; .NET Core from <a href="https://www.microsoft.com/net/download">https://www.microsoft.com/net/download</a></p>
</li>
<li><p>Get a recent version of nodejs (12.x or newer)</p>
</li>
<li><p>Make a build of all the projects and run the tests
 from the root folder of the repository</p>
</li>
</ol>
<p><em>When using powershell:</em></p>
<pre><code class="language-powershell">    .\build.ps1
</code></pre>
<p><em>Or using bash (on Linux and Mac OS)</em></p>
<pre><code class="language-sh">    ./build.sh
</code></pre>
<ol start="4">
<li>Check configuration <code>starsky/starsky/appsettings.json</code></li>
</ol>
<blockquote>
<blockquote>
<p>Tip: You could use machine specific configuration files: appsettings.{machinename}.json <em>(and replace {machinename} with your computer name in lowercase)</em></p>
</blockquote>
</blockquote>
<ol start="5">
<li>Run</li>
</ol>
<pre><code class="language-sh">dotnet run --project starsky/starsky
</code></pre>
<ol start="6">
<li>Create a account in the Starsky application. Those credentials are only required by the web application<blockquote>
<p>Security issue: After creating the first account this endpoint is closed, keep the env variable <code>app__isAccountRegisterOpen</code> to <code>false</code></p>
</blockquote>
</li>
</ol>
<pre><code>http://localhost:64556/account/register
</code></pre>
<h2 id="dev-dependencies">Dev-dependencies:</h2>
<ol>
<li>Editorconfig (<a href="http://editorconfig.org/">http://editorconfig.org/</a>)</li>
<li>Use <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a> to view a local SQLite database <em>(optional)</em></li>
</ol>
<h2 id="build-for-raspberry-pi-raspbianlinux-arm">Build for Raspberry Pi (Raspbian/Linux ARM)</h2>
<p>From .NET Core 2.1 or newer there is a SDK available for Raspberry Pi (only ARMv7 or newer, so no ARMv6). We use NET Core
But in this guide we build it first on your laptop and copy to your Raspberry Pi. Use the following steps to setup:</p>
<ol>
<li>Clone the repo on your x86/x64 machine</li>
</ol>
<pre><code class="language-sh">git clone &quot;https://github.com/qdraw/starsky.git&quot;
</code></pre>
<ol start="2">
<li><p>On your laptop (x86/x64 machine). Get the <code>dotnet</code> 3.0.1 or newer SDK. To get the &#39;Build apps - SDK&#39; .NET Core from <a href="https://www.microsoft.com/net/download">https://www.microsoft.com/net/download</a></p>
</li>
<li><p>Compile the Starsky-installation on your x86/x64 machine first. The cake build script with parameters can be used to build for this runtime.</p>
</li>
</ol>
<p><em>Using bash</em></p>
<pre><code class="language-sh">./build.sh --runtime=&quot;linux-arm&quot;
</code></pre>
<p><em>Using Powershell</em></p>
<pre><code class="language-powershell">powershell -File build.ps1 -ScriptArgs &#39;-runtime=&quot;linux-arm&quot;&#39;
</code></pre>
<ol start="4">
<li><p>Copy contents from the <code>linux-arm</code> folder to your Raspberry Pi</p>
</li>
<li><p>On the Raspi, install the dependency packages first. Those are required by .NET Core</p>
</li>
</ol>
<pre><code class="language-sh">sudo apt-get install curl libunwind8 gettext apt-transport-https tzdata
</code></pre>
<ol start="6">
<li>(Optional) On the Raspi, install Exiftool</li>
</ol>
<p>ExifTool is installed on the first run. When you use system ExifTool you need to update the AppSettings</p>
<pre><code class="language-sh">sudo apt-get install libimage-exiftool-perl
</code></pre>
<ol start="8">
<li>Run the Starsky web interface</li>
</ol>
<pre><code class="language-sh">./starsky
</code></pre>
<ol start="9">
<li>Create a account in the Starsky Web application. Those credentials are only required by the web application</li>
</ol>
<pre><code>http://localhost:5000/account/register
</code></pre>
<h3 id="optional-steps">Optional steps</h3>
<ol start="10">
<li>The script <a href="starsky/pm2-new-instance.sh"><code>pm2-new-instance.sh</code></a> is a script to setup Starsky using <a href="http://pm2.keymetrics.io/">pm2</a>.</li>
</ol>
<pre><code class="language-sh">    export ASPNETCORE_URLS=&quot;http://localhost:4823/&quot;
    export ASPNETCORE_ENVIRONMENT=&quot;Production&quot;
</code></pre>
<ol start="11">
<li>SonarQube scanner</li>
</ol>
<p>For SonarScanner you need to additionally install:</p>
<ul>
<li>Java (<a href="https://docs.sonarqube.org/latest/requirements/requirements/">https://docs.sonarqube.org/latest/requirements/requirements/</a>)</li>
</ul>
<p>To enable SonarScanner you need to set the following environment variables:</p>
<ul>
<li><code>STARSKY_SONAR_KEY</code> - the public name of the project</li>
<li><code>STARSKY_SONAR_LOGIN</code> - the token to login</li>
<li><code>STARSKY_SONAR_ORGANISATION</code> - the name of the organisation</li>
<li><code>STARSKY_SONAR_URL</code> - defaults to sonarcloud.io</li>
</ul>
<h4 id="known-errors">Known errors</h4>
<p>When using SQLite as database type without <code>SQLitePCLRaw.lib.e_sqlite3.linux</code> the following error appears:
<code>System.DllNotFoundException: Unable to load DLL &#39;e_sqlite3&#39;</code></p>
<p>To avoid the error: <code>System.IO.FileLoadException</code> <code>Microsoft.Extensions.Options, Version=2.0.2.0</code> the package `Microsoft.EntityFrameworkCore is installed</p>
<blockquote>
<p>Tip: When using MariaDB or MySQL as database, make sure you use <code>utf8mb4</code> and as collate <code>utf8mb4_unicode_ci</code> to avoid encoding errors.</p>
</blockquote>
<h4 id="cannot-open-shared-object-file-permission-denied">Cannot open shared object file: Permission denied</h4>
<pre><code>./starsky
Failed to load ?? error: &lt;yourpath&gt;/libhostfxr.so: cannot open shared object file: Permission denied
The library libhostfxr.so was found, but loading it from &lt;yourpath&gt;/libhostfxr.so failed
  - Installing .NET Core prerequisites might help resolve this problem.
     https://go.microsoft.com/fwlink/?LinkID=798306&amp;clcid=0x409
</code></pre>
<p>Check your file rights in the folders, they should be 644 for files and 755 for folders.
except for the executable files</p>
<h4 id="startup-problems-with-starskyapp">Startup problems with StarskyApp</h4>
<p>You could try to clean the temp Folder This is located on Mac OS: <code>~/Library/Application\ Support/starsky/</code> and Windows: <code>C:\Users\&lt;user&gt;\AppData\Roaming\starsky\</code></p>
<h3 id="bash-build-and-configuration-scripts">Bash build and configuration scripts</h3>
<p>Those scripts are optional and used for configuration.</p>
<h4 id="pm2-pm2-install-latest-releasesh">pm2 <code>./pm2-install-latest-release.sh</code></h4>
<p>To install and upgrade to the latest stable release run this script</p>
<p>It uses the following default parameters</p>
<pre><code class="language-sh">--name starsky
--runtime linux-arm
</code></pre>
<h4 id="pm2-pm2-new-instancesh">pm2 <code>./pm2-new-instance.sh</code></h4>
<p>The script <a href="starsky/pm2-new-instance.sh"><code>pm2-new-instance.sh</code></a> is a script to setup Starsky using <a href="http://pm2.keymetrics.io/">pm2</a>.</p>
<p>You should install pm2 before running this script</p>
<p>It uses the following env settings</p>
<pre><code class="language-sh"> export ASPNETCORE_URLS=&quot;http://localhost:4823/&quot;
 export ASPNETCORE_ENVIRONMENT=&quot;Production&quot;
</code></pre>
<ul>
<li>It uses by default the name <code>starsky</code> in pm2</li>
<li>If this name already exist, it overwrite this name with the new location</li>
</ul>
<h4 id="pm2-pm2-deploy-on-envsh">pm2 <code>./pm2-deploy-on-env.sh</code></h4>
<p>To update starsky-$RUNTIME.zip with the content of the folder and to remove the content of the parent folder of this script. 
The following content are not deleted: app settings, temp, zip files and database files. 
The starsky files will get executed and need to have those rights. The pm2 instance will be restarted.</p>
<h4 id="pm2-pm2-warmupsh">pm2 <code>./pm2-warmup.sh</code></h4>
<p>To warmup the installation after a restart this bash script is provided</p>
<p>If you prefer a Powershell script, you could use <code>pm2-warmup.ps1</code></p>
<h4 id="publish-scripts-for-self-containing-binaries">Publish-scripts for &#39;self containing&#39; binaries</h4>
<p>The scripts that are used to create a full build. (Linux has <code>libunwind8</code> and <code>gettext</code> as dependency)</p>
<p>The Cake script provide options to build for specific runtimes.</p>
<h3 id="to-build-server-app-for-mac-os">To build server app for Mac OS</h3>
<p><em>Using bash</em></p>
<pre><code class="language-sh">./build.sh --runtime=&quot;osx.10.12-x64&quot;
</code></pre>
<p><em>Using powershell</em></p>
<pre><code class="language-powershell">powershell -File build.ps1 -ScriptArgs &#39;-runtime=&quot;osx.10.12-x64&quot;&#39;
</code></pre>
<h3 id="to-build-server-app-for-64-bits-windows">To build server app for 64 bits Windows</h3>
<p><em>Using bash</em></p>
<pre><code class="language-sh">./build.sh --runtime=&quot;win7-x64&quot;
</code></pre>
<p><em>Using powershell</em></p>
<pre><code class="language-powershell">powershell -File build.ps1 -ScriptArgs &#39;-runtime=&quot;win7-x86&quot;&#39;
</code></pre>

    </div>
</div>
</div>
 </body>
</html>
