<!DOCTYPE HTML>
<html>
<head>
 <!-- 

Do NOT edit this file -  
This Generated by Starsky Docs 

-->
<meta charset="utf-8">
<title>General Starsky (sln) docs</title><link rel="stylesheet" href="../assets/style/style.css"><meta name="viewport" content="width=device-width,initial-scale=1"/></head>
<body>

	<header class="docs-header">
		<div class="wrapper">
			<div class="detective"></div> <a href="../index.html" class="name">Starsky Docs</a>
		</div>
	</header>
<div id="app"><div class="container"><div class="entry-content"><div class="breadcrumb"><a href="../index.html">home</a> » <a href="readme.html">starsky</a> » readme</div>
<h1 id="general-starsky-sln-docs">General Starsky (sln) docs</h1>
<h2 id="list-of-starskyreadmemd-projects">List of <a href="../readme.html">Starsky</a> Projects</h2>
<ul>
<li><a href="../inotify-settings/readme.html">inotify-settings</a> <em>to setup auto indexing on linux</em></li>
<li><strong><a href="../starsky/readme.html">starsky (sln)</a> database photo index & import index project</strong><ul>
<li><a href="../starsky/starsky/readme.html">starsky</a> <em>web api application / interface</em><ul>
<li><a href="../starsky/starsky/clientapp/readme.html">clientapp</a> <em>react front-end application</em></li></ul></li>
<li><a href="../starsky/starskysynccli/readme.html">starskySyncCli</a>  <em>database command line interface</em></li>
<li><a href="../starsky/starskyimportercli/readme.html">starskyImporterCli</a>  <em>import command line interface</em></li>
<li><a href="../starsky/starskygeocli/readme.html">starskyGeoCli</a>  <em>gpx sync and reverse 'geo tagging'</em></li>
<li><a href="../starsky/starskywebhtmlcli/readme.html">starskyWebHtmlCli</a>  <em>publish web images to a content package</em></li>
<li><a href="../starsky/starskywebftpcli/readme.html">starskyWebFtpCli</a>  <em>copy a content package to a ftp service</em></li>
<li><a href="../starsky/starskyadmincli/readme.html">starskyAdminCli</a>  <em>manage user accounts</em></li>
<li><a href="../starsky/starskybusinesslogic/readme.html">Starsky Business Logic</a> <em>business logic libraries (netstandard 2.0)</em></li>
<li><a href="../starsky/starskytest/readme.html">starskyTest</a>  <em>mstest unit tests</em></li></ul></li>
<li><a href="../starsky.netframework/readme.html">starsky.netframework</a> <em>Client for older machines</em></li>
<li><a href="../starsky-tools/readme.html">starsky-tools</a> <em>nodejs tools to add-on tasks</em></li>
<li><a href="../starskyapp/readme.html">starskyapp</a> <em>Desktop Application (Pre-alpha code)</em></li>
</ul>
<h2 id="build-instructions-for-docker">Build instructions for docker</h2>
<p>See the <a href="docker-instructions.html">Docker instructions</a> for more details about how to install</p>
<h2 id="build-instructions-without-docker">Build instructions (without docker)</h2>
<ol>
<li>To get started clone the repository</li>
</ol>
<pre><code class="sh language-sh">git clone "https://github.com/qdraw/starsky.git"</code></pre>
<ol start="2">
<li><p>Get the <code>dotnet</code> 3.1.300 or newer SDK. To get the 'Build apps - SDK' .NET Core from <a href="https://www.microsoft.com/net/download">https://www.microsoft.com/net/download</a></p></li>
<li><p>Make a build of all the projects and run the tests<br />
from the root folder of the repository</p></li>
</ol>
<p><em>When using powershell:</em></p>
<pre><code class="powershell language-powershell">    .\build.ps1</code></pre>
<p><em>Or using bash (on Linux and Mac OS)</em></p>
<pre><code class="sh language-sh">    ./build.sh</code></pre>
<ol start="4">
<li>Check configuation <code>starsky/starsky/appsettings.json</code></li>
</ol>
<blockquote>
  <blockquote>
    <p>Tip: You could use machine specific configuration files: appsettings.{machinename}.json <em>(and replace {machinename} with your computer name in lowercase)</em></p>
  </blockquote>
</blockquote>
<ol start="5">
<li>Run</li>
</ol>
<pre><code class="sh language-sh">dotnet run --project starsky/starsky</code></pre>
<ol start="6">
<li>Create a account in the Starsky application. Those credentials are only required by the web application</li>
</ol>
<blockquote>
  <p>Security issue: After creating the first account this endpoint is closed, do not set the env variable <code>app__isAccountRegisterOpen</code> to <code>true</code></p>
</blockquote>
<pre><code>http://localhost:64556/account/register</code></pre>
<h2 id="dev-dependencies">Dev-dependencies:</h2>
<ol>
<li>Editorconfig (<a href="http://editorconfig.org/">http://editorconfig.org/</a>)</li>
<li>Use <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a> to view a local SQLite database <em>(optional)</em></li>
</ol>
<h2 id="build-for-raspberry-pi-raspbianlinux-arm">Build for Raspberry Pi (Raspbian/Linux ARM)</h2>
<p>From .NET Core 2.1 or newer there is a SDK available for Raspberry Pi (only ARMv7 or newer, so no ARMv6). We use NET Core 3.1.201<br />
But in this guide we build it first on your laptop and copy to your Raspberry Pi. Use the following steps to setup:</p>
<ol>
<li>Clone the repo on your x86/x64 machine</li>
</ol>
<pre><code class="sh language-sh">git clone "https://github.com/qdraw/starsky.git"</code></pre>
<ol start="2">
<li><p>On your laptop (x86/x64 machine). Get the <code>dotnet</code> 3.0.1 or newer SDK. To get the 'Build apps - SDK' .NET Core from <a href="https://www.microsoft.com/net/download">https://www.microsoft.com/net/download</a></p></li>
<li><p>Compile the Starsky-installation on your x86/x64 machine first. The cake build script with parameters can be used to build for this runtime.</p></li>
</ol>
<p><em>Using bash</em></p>
<pre><code class="sh language-sh">./build.sh --runtime="linux-arm"</code></pre>
<p><em>Using powershell</em></p>
<pre><code class="powershell language-powershell">powershell -File build.ps1 -ScriptArgs '-runtime="linux-arm"'</code></pre>
<ol start="4">
<li><p>Copy contents from the <code>linux-arm</code> folder to your Raspberry Pi</p></li>
<li><p>On the Raspi, install the dependency packages first. Those are required by .NET Core</p></li>
</ol>
<pre><code class="sh language-sh">sudo apt-get install curl libunwind8 gettext apt-transport-https tzdata</code></pre>
<ol start="6">
<li>(Optional) On the Raspi, install Exiftool</li>
</ol>
<p>ExifTool is installed on the first run. When you use system ExifTool you need to update the AppSettings</p>
<pre><code class="sh language-sh">sudo apt-get install libimage-exiftool-perl</code></pre>
<ol start="8">
<li>Run the Starsky web interface</li>
</ol>
<pre><code class="sh language-sh">./starsky</code></pre>
<ol start="9">
<li>Create a account in the Starsky Web application. Those credentials are only required by the web application</li>
</ol>
<blockquote>
  <p>This endpoint is open to anyone when there are no accounts or for a logged in user or when you update appsettings.json</p>
</blockquote>
<pre><code>http://localhost:5000/account/register</code></pre>
<h3 id="optional-steps">Optional steps</h3>
<ol start="10">
<li>The script <a href="starsky/pm2-new-instance.sh"><code>pm2-new-instance.sh</code></a> is a script to setup Starsky using <a href="http://pm2.keymetrics.io/">pm2</a>.</li>
</ol>
<pre><code class="sh language-sh">    export ASPNETCORE_URLS="http://localhost:4823/"
    export ASPNETCORE_ENVIRONMENT="Production"</code></pre>
<ol start="11">
<li>SonarQube scanner</li>
</ol>
<p>For SonarScanner you need to additionally install:</p>
<ul>
<li>.NET Core 2.0 runtime: <a href="https://dotnet.microsoft.com/download/dotnet-core/2.0">https://dotnet.microsoft.com/download/dotnet-core/2.0</a></li>
<li>Java</li>
</ul>
<p>To enable SonarScanner you need to set the following environment variables:</p>
<ul>
<li><code>STARSKY_SONAR_KEY</code> - the public name of the project</li>
<li><code>STARSKY_SONAR_LOGIN</code> - the token to login</li>
<li><code>STARSKY_SONAR_ORGANISATION</code> - the name of the organisation</li>
<li><code>STARSKY_SONAR_URL</code> - defaults to sonarcloud.io</li>
</ul>
<h4 id="known-errors">Known errors</h4>
<p>When using SQLite as databasetype without <code>SQLitePCLRaw.lib.e_sqlite3.linux</code> the following error appears:<br />
<code>System.DllNotFoundException: Unable to load DLL 'e_sqlite3'</code></p>
<p>To avoid the error: <code>System.IO.FileLoadException</code> <code>Microsoft.Extensions.Options, Version=2.0.2.0</code> the package `Microsoft.EntityFrameworkCore is installed</p>
<blockquote>
  <p>Tip: When using MariaDB or MySQL as database, make sure you use <code>utf8mb4</code> and as collate <code>utf8mb4_unicode_ci</code> to avoid encoding errors.</p>
</blockquote>
<h4 id="cannot-open-shared-object-file-permission-denied">Cannot open shared object file: Permission denied</h4>
<pre><code>./starsky
Failed to load ?? error: &lt;yourpath&gt;/libhostfxr.so: cannot open shared object file: Permission denied
The library libhostfxr.so was found, but loading it from &lt;yourpath&gt;/libhostfxr.so failed
  - Installing .NET Core prerequisites might help resolve this problem.
     https://go.microsoft.com/fwlink/?LinkID=798306&amp;clcid=0x409</code></pre>
<p>Check your file rights in the folders, they should be 644 for files and 755 for folders.<br />
except for the executable  files</p>
<h3 id="bash-build-and-configuation-scripts">Bash build and configuation scripts</h3>
<p>Those scripts are optional and used for configuation.</p>
<h4 id="pm2-pm2-new-instancesh">pm2 <code>pm2-new-instance.sh</code></h4>
<p>The script <a href="starsky/pm2-new-instance.sh"><code>pm2-new-instance.sh</code></a> is a script to setup Starsky using <a href="http://pm2.keymetrics.io/">pm2</a>.</p>
<pre><code class="sh language-sh"> export ASPNETCORE_URLS="http://localhost:4823/"
 export ASPNETCORE_ENVIRONMENT="Production"</code></pre>
<h4 id="pm2-pm2-deploy-on-envsh">pm2 <code>pm2-deploy-on-env.sh</code></h4>
<p>To remove the content of the parent folder of this script. The following content are not deleted: app settings, temp, zip files and database files. The starsky files will get executed and need to have those rights. The pm2 instance will be restarted.</p>
<h4 id="pm2-pm2-warmupsh">pm2 <code>pm2-warmup.sh</code></h4>
<p>To warmup the installation after a restart this bash script is provided</p>
<h4 id="publish-scripts-for-self-containing-binaries">Publish-scripts for 'self containing' binaries</h4>
<p>The scripts that are used to create a full build. (Linux has <code>libunwind8</code> and <code>gettext</code> as dependency)</p>
<p>The Cake script provide options to build for specific runtimes.</p>
<h3 id="to-build-for-mac-os">To build for Mac OS</h3>
<p><em>Using bash</em></p>
<pre><code class="sh language-sh">./build.sh --runtime="osx.10.12-x64"</code></pre>
<p><em>Using powershell</em></p>
<pre><code class="powershell language-powershell">powershell -File build.ps1 -ScriptArgs '-runtime="osx.10.12-x64"'</code></pre>
<h3 id="to-build-for-64-bits-windows">To build for 64 bits Windows</h3>
<p><em>Using bash</em></p>
<pre><code class="sh language-sh">./build.sh --runtime="win7-x64"</code></pre>
<p><em>Using powershell</em></p>
<pre><code class="powershell language-powershell">powershell -File build.ps1 -ScriptArgs '-runtime="win7-x86"'</code></pre>
</div>
</div>
</div>
 </body>
</html>