<!DOCTYPE HTML>
<html>
<head>
 <!-- 

Do NOT edit this file -  
This Generated by Starsky Docs 

-->
<meta charset="utf-8">
<title>Starsky Web API application</title><link rel="stylesheet" href="../../assets/style/style.css"><meta name="viewport" content="width=device-width,initial-scale=1"/></head>
<body>

	<header class="docs-header">
		<div class="wrapper">
			<div class="detective"></div> <a href="../../index.html" class="name">Starsky Docs</a>
		</div>
	</header>
<div id="app"><div class="container"><div class="entry-content"><div class="breadcrumb"><a href="../../index.html">home</a> » <a href="../readme.html">starsky</a> » <a href="readme.html">starsky</a> » readme</div>
<h1 id="starsky-web-api-application">Starsky Web API application</h1>
<h2 id="list-of-starskyreadmemd-projects">List of <a href="../../readme.html">Starsky</a> Projects</h2>
<ul>
<li><a href="../../inotify-settings/readme.html">inotify-settings</a> <em>to setup auto indexing on linux</em></li>
<li><a href="../../starsky/readme.html">starsky (sln)</a> <em>database photo index & import index project</em><ul>
<li><strong><a href="../../starsky/starsky/readme.html">starsky</a> web api application / interface</strong><ul>
<li><a href="../../starsky/starsky/clientapp/readme.html">clientapp</a> <em>react front-end application</em></li></ul></li>
<li><a href="../../starsky/starskysynccli/readme.html">starskySyncCli</a>  <em>database command line interface</em></li>
<li><a href="../../starsky/starskyimportercli/readme.html">starskyImporterCli</a>  <em>import command line interface</em></li>
<li><a href="../../starsky/starskygeocli/readme.html">starskyGeoCli</a>  <em>gpx sync and reverse 'geo tagging'</em></li>
<li><a href="../../starsky/starskywebhtmlcli/readme.html">starskyWebHtmlCli</a>  <em>publish web images to a content package</em></li>
<li><a href="../../starsky/starskywebftpcli/readme.html">starskyWebFtpCli</a>  <em>copy a content package to a ftp service</em></li>
<li><a href="../../starsky/starskyadmincli/readme.html">starskyAdminCli</a>  <em>manage user accounts</em></li>
<li><a href="../../starsky/starskybusinesslogic/readme.html">Starsky Business Logic</a> <em>business logic libraries (netstandard 2.0)</em></li>
<li><a href="../../starsky/starskytest/readme.html">starskyTest</a>  <em>mstest unit tests</em></li></ul></li>
<li><a href="../../starsky.netframework/readme.html">starsky.netframework</a> <em>Client for older machines</em></li>
<li><a href="../../starsky-tools/readme.html">starsky-tools</a> <em>nodejs tools to add-on tasks</em></li>
<li><a href="../../starskyapp/readme.html">starskyapp</a> <em>Desktop Application (Pre-alpha code)</em></li>
</ul>
<h2 id="starskystarsky-docs">starsky/starsky docs</h2>
<h3 id="structure-configuration">Structure configuration:</h3>
<p>When setup Starksy there are two options to configure the installation.<br />
There is a list of required settings. First the <code>appsettings.json</code> is loaded and the environment variables are overwriting features.<br />
The command line arguments are shortcuts to set an in-app environment variable.</p>
<h3 id="the-order-of-reading-settings">The order of reading settings</h3>
<p>You could use machine specific configuration files: appsettings.{machinename}.json <em>(and replace {machinename} with your computer name in lowercase)</em></p>
<ol>
<li><p>You can use <code>appsettings.json</code> inside the application folder to set base settings. <br />
The order of this files is used to get the values from the appsettings</p>
<ul>
<li><code>/bin/Debug/netcoreapp3.1/appsettings.patch.json</code></li>
<li><code>/bin/Debug/netcoreapp3.1/appsettings.computername.patch.json</code></li>
<li><code>/bin/Debug/netcoreapp3.1/appsettings.json</code></li>
<li><code>/bin/Debug/netcoreapp3.1/appsettings.computername.json</code></li></ul></li>
<li><p>Use Environment variables to overwrite those base settings<br />
For <code>ThumbnailTempFolder</code> use <code>app__ThumbnailTempFolder</code> <br />
(<a href="https://github.com/aspnet/Configuration/commit/cafd2e53eb71a6d0cecc60a9e38ea1df2dafb916">source</a>)  </p></li>
<li><p>Command line argumements in the Cli applications to set in-app environment variables</p></li>
</ol>
<h3 id="required-settings-to-start">Required settings to start</h3>
<ol>
<li>There are <strong>no</strong> settings required</li>
</ol>
<h3 id="recommend-settings">Recommend settings</h3>
<ol>
<li><code>ThumbnailTempFolder</code> - For storing thumbnails (default: <code>./bin/Debug/netcoreapp3.1/thumbnailTempFolder</code>)</li>
<li><code>StorageFolder</code> - For the main photo directory (default: <code>./bin/Debug/netcoreapp3.1/storageFolder</code>)</li>
<li><code>DatabaseType</code> - <code>mysql</code>, <code>sqlite</code> or  <code>inmemorydatabase</code> are supported (default: <code>sqlite</code>)</li>
<li><code>DatabaseConnection</code> - The connection-string to the database (default: <code>./bin/Debug/netcoreapp3.1/data.db</code>)</li>
<li><code>CameraTimeZone</code> - The timezone of the Camera, for example <code>Europe/Amsterdam</code> (defaults to your local timezone)</li>
</ol>
<h3 id="optional-settings">Optional settings</h3>
<ol>
<li><code>Structure</code> - The structure that will be used when you import files, has a default fallback.</li>
<li><code>ReadOnlyFolders</code> - Accepts a list of folders that never may be edited, defaults a empty list</li>
<li><code>AddMemoryCache</code> - Enable caching <em>(default true)</em></li>
<li><code>IsAccountRegisterOpen</code>  - Keep registrations always open. <br />
 The only 2 build-in exceptions are when there are no accounts or you already logged in <em>(default false)</em></li>
<li><code>AddSwagger</code> - To show a user interface to show al REST-services <em>(default false)</em></li>
<li><code>ExifToolImportXmpCreate</code> - is used to create at import time a xmp file based on the raw image <em>(default false)</em></li>
<li><code>AddSwaggerExport</code> - <em>Temporary disabled due known issue</em> To Export Swagger defentions on startup <em>(default false)</em></li>
<li><code>AddLegacyOverwrite</code>- Read Only value for ("Mono.Runtime") <em>(default false)</em></li>
<li><code>Verbose</code> - show more console logging  <em>(default false)</em></li>
<li><code>WebFtp</code> - used by starskyWebFtpCli</li>
<li><code>PublishProfiles</code> - used by starskyWebHtmlCli</li>
<li><code>ExifToolPath</code> - A path to Exiftool.exe <em>to ignore the included ExifTool</em></li>
<li><code>isAccountRegisterOpen</code> - Allow everyone to register an account <em>(default false)</em></li>
<li><code>applicationInsightsInstrumentationKey</code> - Track telementry with Microsoft Application Insights <em>(default disabled)</em></li>
</ol>
<h3 id="appsettingsjson-example">Appsettings.json example</h3>
<pre><code class="json language-json">{
  "App": {
    "ThumbnailTempFolder": "Y:\\data\\photodirectory\\temp",
    "StorageFolder": "Y:\\data\\photodirectory\\storage",
    "DatabaseType": "mysql",
    "DatabaseConnection": "Server=mysqlserver.nl;database=dbname;uid=username;pwd=password;",
    "Structure": "/yyyy/MM/yyyy_MM_dd/yyyyMMdd_HHmmss_{filenamebase}.ext",
    "ReadOnlyFolders": ["/2015","/2018"],
    "AddMemoryCache": "true",
    "CameraTimeZone": "America/New_York"
  }
}</code></pre>
<blockquote>
  <p>Note: When using a boolean in the json add quotes. Booleans without quotes are ignored</p>
</blockquote>
<blockquote>
  <p>Tip: When using the <code>mysql</code>-setting, make sure the database uses <code>utf8mb4</code> and as collate <code>utf8mb4_unicode_ci</code> to avoid encoding errors.</p>
</blockquote>
<h4 id="appsettings-notes">Appsettings Notes</h4>
<ol>
<li>Structure uses slash as directory separators for Linux and Windows</li>
<li>The settings: <code>ExifToolPath</code>, <code>ThumbnailTempFolder</code> and  <code>StorageFolder</code> uses the system path directory separators</li>
<li>When using Windows please double escape (<code>\\</code>) system path's</li>
</ol>
<h3 id="warmup-script">Warmup script</h3>
<p>The default behavior of .NET is to load everything first. <br />
To be sure that the application is warm before someone arrives, please check <code>tools/starsky-warmup.sh</code>.</p>
<h3 id="search-docs">Search Docs</h3>
<p>Advanced queries are supported by the basic search engine.</p>
<p><strong>All text (not number or date) driven search queries use a contain search</strong></p>
<table>
<thead>
<tr>
<th id="search_options">Search options</th>
<th id="example">example</th>
<th id="description">description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>-tags</strong></td>
<td>test</td>
<td>default option</td>
</tr>
<tr>
<td>-tags</td>
<td>-tags="testtag"</td>
<td></td>
</tr>
<tr>
<td>-tags</td>
<td>-test apple</td>
<td>Ignore the keyword test</td>
</tr>
<tr>
<td>-tags</td>
<td>-Tags-"test"</td>
<td>Ignore the keyword test</td>
</tr>
<tr>
<td>-tags</td>
<td>apple banana</td>
<td>search for apple or banana</td>
</tr>
<tr>
<td><strong>-title</strong></td>
<td>-title="example"</td>
<td></td>
</tr>
<tr>
<td><strong>-filepath</strong></td>
<td>-filepath="/path"</td>
<td>-inurl is the same</td>
</tr>
<tr>
<td><strong>-filename</strong></td>
<td>-filename="file.jpg"</td>
<td></td>
</tr>
<tr>
<td><strong>-filehash</strong></td>
<td>-filehash=3DB75N7JJ6FDOPZY4YHGX4TL</td>
<td></td>
</tr>
<tr>
<td><strong>-parentdirectory</strong></td>
<td>-parentdirectory="/2019"</td>
<td></td>
</tr>
<tr>
<td><strong>-description</strong></td>
<td>-description="search"</td>
<td></td>
</tr>
<tr>
<td><strong>-imageformat</strong></td>
<td>-ImageFormat="jpg"</td>
<td>include <code>jpeg</code></td>
</tr>
<tr>
<td>-imageformat</td>
<td>-ImageFormat="tiff"</td>
<td>including <code>dng</code></td>
</tr>
<tr>
<td>-imageformat</td>
<td>-ImageFormat="bmp"</td>
<td></td>
</tr>
<tr>
<td>-imageformat</td>
<td>-ImageFormat="gif"</td>
<td></td>
</tr>
<tr>
<td>-imageformat</td>
<td>-ImageFormat="png"</td>
<td></td>
</tr>
<tr>
<td>-imageformat</td>
<td>-ImageFormat="xmp"</td>
<td></td>
</tr>
<tr>
<td>-imageformat</td>
<td>-ImageFormat="gpx"</td>
<td></td>
</tr>
<tr>
<td><strong>-datetime</strong></td>
<td>-datetime=1</td>
<td>search for yesterday</td>
</tr>
<tr>
<td>-datetime</td>
<td>-datetime&gt;12 -datetime&lt;2</td>
<td>between 2 and 12 days ago</td>
</tr>
<tr>
<td>-datetime</td>
<td>-datetime=2020-01-01</td>
<td>between 00:00:00 and 23:59:59</td>
</tr>
<tr>
<td>-datetime</td>
<td>-datetime=2020-01-01T14:35:29</td>
<td>on this exact time</td>
</tr>
<tr>
<td><strong>-addtodatabase</strong></td>
<td>-addtodatabase=1</td>
<td>search for yesterday</td>
</tr>
<tr>
<td>-addtodatabase</td>
<td>-addtodatabase&gt;12 -addtodatabase&lt;2</td>
<td>between 2 and 12 days ago</td>
</tr>
<tr>
<td>-addtodatabase</td>
<td>-addtodatabase=2020-01-01</td>
<td>between 00:00:00 and 23:59:59</td>
</tr>
<tr>
<td>-addtodatabase</td>
<td>-addtodatabase=2020-01-01T14:35:29</td>
<td>on this exact time</td>
</tr>
<tr>
<td><strong>-lastedited</strong></td>
<td>-lastedited=1</td>
<td>search for yesterday</td>
</tr>
<tr>
<td>-lastedited</td>
<td>-lastedited&gt;12 -lastedited&lt;2</td>
<td>between 2 and 12 days ago</td>
</tr>
<tr>
<td>-lastedited</td>
<td>-lastedited=2020-01-01</td>
<td>between 00:00:00 and 23:59:59</td>
</tr>
<tr>
<td>-lastedited</td>
<td>-lastedited=2020-01-01T14:35:29</td>
<td>on this exact time</td>
</tr>
<tr>
<td><strong>-isdirectory</strong></td>
<td>-isdirectory=true</td>
<td>search for folders</td>
</tr>
<tr>
<td>-isdirectory</td>
<td>-isdirectory=false</td>
<td>search for items</td>
</tr>
<tr>
<td><strong>-make</strong></td>
<td>-make=Apple</td>
<td>brand name of the camera</td>
</tr>
<tr>
<td><strong>-model</strong></td>
<td>-model="iPhone SE"</td>
<td>search for camera model</td>
</tr>
</tbody>
</table>
<h3 id="rest-api-documentation">Rest API documentation</h3>
<p>Starsky has a Json restful API. Please read the documentation</p>
<blockquote>
  <p>Tip: Breaking changes are documentated in <code>./history.md</code></p>
</blockquote>
<h3 id="swagger--openapi">Swagger / OpenAPI</h3>
<p>Swagger is an open-source software framework backed by a large ecosystem <br />
of tools that helps developers design, build, document, and consume RESTful Web services. <br />
There is an swagger definition. You could enable this by setting the following values:</p>
<p>By default this feature is disabled, please use the <code>AddSwagger</code> definition in the AppSettings or use the following environment variable:</p>
<pre><code>app__AddSwagger=true</code></pre>
<p>This is the default location of the swagger documentation</p>
<pre><code>http://localhost:5000/swagger</code></pre>
<h3 id="known-there-are-critical-errors-in-the-following-components">Known 'There are critical errors in the following components:'</h3>
<p>When the UI starts there is an Health API check to make sure that some important components works good</p>
<h4 id="disk-space-errors">Disk Space errors</h4>
<ul>
<li><strong>Storage_StorageFolder</strong> There is not enough disk space available on the storage folder location </li>
<li><strong>Storage_ThumbnailTempFolder</strong> There is not enough disk space available on the thumbnails folder location </li>
<li><strong>Storage_TempFolder</strong> There is not enough disk space available on the temp folder location </li>
</ul>
<h4 id="not-exist-errors">Not exist errors</h4>
<ul>
<li><strong>Exist_StorageFolder</strong> The Storage Folder does not exist, please create it first.</li>
<li><strong>Exist_TempFolder</strong> The Temp Folder does not exist, please create it first.</li>
<li><strong>Exist_ExifToolPath</strong> ExifTool is not linked, you need this to write meta data to files.ExifTool.<br />
Try to remove the <em>temp folder</em> and run the Application again.</li>
<li><strong>Exist_ThumbnailTempFolder</strong> The Thumbnail cache Folder does not exist, please create it first.</li>
</ul>
<h4 id="dbcontext-mysql-or-sqlite">DbContext, Mysql or Sqlite</h4>
<p>There is also a check to make sure the database runs good</p>
</div>
</div>
</div>
 </body>
</html>